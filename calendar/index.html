<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Calendar | FOSS@RIT</title>

        <meta name="google-site-verification" content="S1TGL46nruysWj0a2nw64L1D6MYxZj_QB4Ku4yrhkJU" />
    <meta property="og:title" content="Calendar" />
    <meta name="twitter:title" content="Calendar" />
    <meta property="og:url" content="https://fossrit.github.io/calendar/" />
    <meta property="og:site_name" content="Free and Open Source Software @ RIT" />
    <meta name="application-name" content="Free and Open Source Software @ RIT" />
    <meta name="twitter:site" content="@RITMAGIC" />
    <meta name="twitter:card" content="summary_large_image" />
    
        <meta name="description" content="Center of gravity for Free and Open Source Software at the Rochester Institute of Technology. Learn about open source activities and academia at RIT.
">
        <meta property="og:description" content="Center of gravity for Free and Open Source Software at the Rochester Institute of Technology. Learn about open source activities and academia at RIT.
">
    
    
        <meta property="og:type" content="website" />
    
    
        <meta property="og:image" content="https://fossrit.github.io/img/logo.png" />
        <meta name="twitter:image" content="https://fossrit.github.io/img/logo.png" />
    
    <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Organization",
        "name": "Free and Open Source Software @ RIT",
        "alternateName": "FOSS@RIT",
        "logo": "https://fossrit.github.io/img/logo.png",
        "url": "https://fossrit.github.io",
        "sameAs": [
            "https://twitter.com/@RITMAGIC"
        ],
        "knowsAbout": [
            "FOSS@MAGIC", "FOSSRIT", "RIT FOSS", "RIT MAGIC Center", "Rochester Institute of Technology", "Open@RIT", "open source", "Stephen Jacobs"

        ],
        "location": {
            "@type": "Place",
            "name": "Rochester Institute of Technology",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "Henrietta",
                "addressRegion": "NY"
            }
        }
    }
    </script>


    <!-- favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico" />
    <link rel="apple-touch-icon" href="/img/favicon.ico">

    <link href="https://fonts.googleapis.com/css?family=Overpass|Roboto:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css" />
</head>

<body class="bg-light">

        <header>
        <nav class="navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand" href="/">
                <img src="/img/logo.png" alt="Home" class="d-inline-block align-top" style="width:225px;" />
            </a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                
                    
                        
                        <li class="nav-item">
                        
                            <a class="nav-link" href="/">Home</a>
                        </li>
                    
                
                    
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                
                                <a class="dropdown-item" href="/about/">About</a>
                                
                                <a class="dropdown-item" href="/history/">History</a>
                                
                                <a class="dropdown-item" href="/librecorps/">LibreCorps</a>
                                
                                <a class="dropdown-item" href="https://openr.it/">Open@RIT</a>
                                
                                <a class="dropdown-item" href="/events/">Events</a>
                                
                                <a class="dropdown-item" href="/projects/">Projects</a>
                                
                            </div>
                        </li>
                    
                
                    
                        
                        <li class="nav-item">
                        
                            <a class="nav-link" href="/announcements/">Announcements</a>
                        </li>
                    
                
                    
                        
                        <li class="nav-item active">
                        
                            <a class="nav-link" href="/calendar/">Calendar</a>
                        </li>
                    
                
                    
                        
                        <li class="nav-item">
                        
                            <a class="nav-link" href="/people/">People</a>
                        </li>
                    
                
                    
                        
                        <li class="nav-item">
                        
                            <a class="nav-link" href="/get-involved/">Get Involved</a>
                        </li>
                    
                
                </ul>
            </div>
        </nav>

        <a href="https://github.com/FOSSRIT/fossrit.github.io" class="d-none d-lg-block">
            <img style="z-index: 10; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png">
        </a>
      </header>


    <main>
        <article class="container card">
    <div class="card-body">
        <h1 class="card-title">Calendar <a href="/feeds/calendar.ics" target="_blank"><span class="far fa-calendar-alt icon-orange"></span></a></h1>
        <div id="menu">
            <span id="menu-navi">
                <button type="button" class="btn btn-default btn-sm move-today" data-action="move-today">Today</button>
                <button type="button" class="btn btn-default btn-sm move-day" data-action="move-prev">
                <i class="fas fa-chevron-left" data-action="move-prev"></i>
                </button>
                <button type="button" class="btn btn-default btn-sm move-day" data-action="move-next">
                <i class="fas fa-chevron-right" data-action="move-next"></i>
                </button>
            </span>
            <span id="renderRange" class="render-range"></span>
        </div>
        <br>

        <div id="calendar"></div>
        <br>
    </div>
</article>

<link rel="stylesheet" type="text/css" href="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.css" />
<script src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
<script src="https://uicdn.toast.com/tui.dom/v3.0.0/tui-dom.js"></script>
<script src="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.3.0/ical.min.js" integrity="sha256-1oaCObP6yNz1ouAW50FOpNBBSNqZtpINrbL8B4W+kmM=" crossorigin="anonymous"></script>
<script>
// Load iCal feed (generated by Jekyll)
fetch('/feeds/calendar.ics').then((res) => {
    // If fails to load, error and stop
    if(!res.ok) {
        document.querySelector('#calendar').innerText = 'Could not load feed (request failed)';
        return;
    }

    // Get body of request
    res.text().then((str) => {
        try {
            // Parse with ical.js
            let parsed = ICAL.parse(str);

            // Helpers for month text
            const monthText = document.querySelector('.render-range');
            const updateMonthText = () => {
                monthText.innerText = new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(calendar.getDate().toDate());
            }

            // Initialize calendar
            let calendar = new tui.Calendar('#calendar', {
                defaultView: 'month',
                isReadOnly: true,
                usageStatistics: false,
                useCreationPopup: false,
                useDetailPopup: true
            });

            // Bind buttons to calendar
            document.querySelector('[data-action="move-today"]').addEventListener('click', () => { calendar.today(); updateMonthText(); });
            document.querySelector('[data-action="move-next"]').addEventListener('click', () => { calendar.next(); updateMonthText(); });
            document.querySelector('[data-action="move-prev"]').addEventListener('click', () => { calendar.prev(); updateMonthText(); });
            updateMonthText();

            // Array of events to eventually be loaded into the calendar
            let evtArr = [];

            // Iterate through events from iCal feed
            parsed[2].forEach((i, no) => {
                // Define base parameters
                let obj = {
                    bgColor: 'black',
                    body: '',
                    category: 'time',
                    color: 'white',
                    id: `${no}`,
                    isReadOnly: true,
                    isVisible: true
                };

                // Define vars for special cases
                let rrule = false;
                let url = '';

                // Iterate through parameters and map to object properties
                // (Convert iCal property names to tui.calendar property names)
                i[1].forEach((j) => {
                    switch (j[0]) {
                        case 'summary':
                            obj.title = j[3];
                            break;
                        case 'description':
                            obj.body = j[3];
                            break;
                        case 'dtstart':
                            // ical.js adds empty time strings if an all-day event
                            // strip these and set all-day properties instead if needed
                            if(j[3].endsWith('T::')) {
                                obj.category = 'allday';
                                obj.isAllDay = true;
                                obj.start = j[3].replace('T::','');
                            } else {
                                obj.start = j[3];
                            }
                            break;
                        case 'dtend':
                            // Strip empty time strings if needed (see dtstart comments)
                            obj.end = j[3].replace('T::','');
                            break;
                        case 'location':
                            obj.location = j[3];
                            break;
                        case 'rrule':
                            // RRULE will get interpreted from object later
                            // Just set special case var to trigger parsing later
                            rrule = true;
                            break;
                        case 'url':
                            url = j[3];
                            break;
                    }
                });

                // If has URL, append to body (since no field for in details popup)
                if(url !== '') {
                    obj.body += `${(obj.body === '' ? '' : '<br>')}<a href="${url}">${url}</a>`;
                }

                // tui.calendar can't handle RRULEs (recurrence rules)
                // So, if an RRULE is set, use ical.js to expand occurances manually
                if(rrule) {
                    // Create ical.js component from jCal output of parse
                    let comp = new ICAL.Component(i);

                    // Figure out the duration of the event (since can't directly expand start & end at the same time)
                    let duration = ICAL.Time.fromString(obj.end).subtractDate(ICAL.Time.fromString(obj.start));

                    // Create RRULE Expansion with ical.js
                    // (Creates an interable)
                    let expand = new ICAL.RecurExpansion({
                        component: comp,
                        dtstart: comp.getFirstPropertyValue('dtstart')
                    });

                    // Counter to prevent infinite iteration of RRULE (since by spec is allowed)
                    let count = 0;

                    // next defined here b/c of block scoping
                    let next;

                    // Iterate through occurances
                    // Arbitrary limit of 25 is for infinite iteration prevention
                    while(count < 25 && (next = expand.next())) {
                        // Increment infinite iteration prevention counter
                        count++;

                        // Duplicate event with RRULE
                        let o = {};
                        Object.assign(o, obj);

                        // Give unique ID
                        o.id += `::RRULE-n${count}`;

                        // Set start to this occurance from RRULE expansion
                        o.start = next.toString();

                        // Reconstruct end from duration and set
                        let end = ICAL.Time.fromJSDate(next.toJSDate());
                        end.addDuration(duration);
                        o.end = end.toString();

                        // Add to events array
                        evtArr.push(o);
                    }
                } else {
                    // If no RRULE, directly add to events array
                    evtArr.push(obj);
                }
            });

            // Add events in array to calendar
            calendar.createSchedules(evtArr);
        } catch(err) {
            // Error on parsing fail
            document.querySelector('#calendar').innerText = `Could not parse: ${err}`;
            return;
        }
    }).catch(() => {
        // Error on load fail
        document.querySelector('#calendar').innerText = 'Could not load feed (no body)';
        return;
    });
});
</script>

    </main>

    <footer class="container-fluid bg-dark">
    <div class="container">
        <div class="row">
            <div class="col-12 col-md-4 col-lg-3">
                <p><strong>Navigate</strong></p>
                <ul>
                    <!-- site navigation tabs -->
                    
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="">About</a>
                    </li>
                    
                    <li>
                        <a href="/announcements/">Announcements</a>
                    </li>
                    
                    <li>
                        <a href="/calendar/">Calendar</a>
                    </li>
                    
                    <li>
                        <a href="/people/">People</a>
                    </li>
                    
                    <li>
                        <a href="/get-involved/">Get Involved</a>
                    </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 col-lg-3">
                <p><strong>RIT</strong></p>
                <ul>
                    <!-- RIT footer links -->
                    
                    <li>
                        <a href="https://www.rit.edu">University Website</a>
                    </li>
                    
                    <li>
                        <a href="https://runbook.fossrit.community/">FOSS@RIT Runbook</a>
                    </li>
                    
                    <li>
                        <a href="https://people.rit.edu/djaigm/planet/hfoss/">HFOSS student blog aggregator</a>
                    </li>
                    
                    <li>
                        <a href="https://magic.rit.edu/">RIT MAGIC Center</a>
                    </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 col-lg-3">
                <p><strong>Linux Resources</strong></p>
                <ul>
                    <!-- linux resources -->
                    
                    <li>
                        <a href="https://wiki.archlinux.org">ArchWiki</a>
                    </li>
                    
                    <li>
                        <a href="https://kernelnewbies.org">Kernel Newbies</a>
                    </li>
                    
                    <li>
                        <a href="https://reddit.com/r/linux">Linux Subreddit</a>
                    </li>
                    
                    <li>
                        <a href="https://distrowatch.org">DistroWatch</a>
                    </li>
                    
                    <li>
                        <a href="https://mirrors.rit.edu">RIT Linux Mirror</a>
                    </li>
                    
                </ul>
            </div>
            <div class="col-12 col-md-4 col-lg-3">
                <p><strong>Feeds</strong></p>
                <ul>
                    <!-- feeds -->
                    
                    <li>
                        <a href="/feeds/latest.xml">Announcements</a>
                    </li>
                    
                    <li>
                        <a href="/feeds/events.xml">Events</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <p>
                    <strong>Site Information:</strong><br />
                    Source code for this website is found <a href="https://github.com/FOSSRIT/fossrit.github.io" target="_blank">on GitHub</a>. Original design by <a href="https://ctmartin.me/" target="_blank">Christian Martin</a> for <a href="https://ritlug.com/" target="_blank">ritlug.com</a>.
                </p>
            </div>
        </div>
    </div>
</footer>


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
</body>
</html>
